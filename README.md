# 京东万商商品数据爬虫

基于 Playwright + Stealth 的京东万商（b2b.jd.com）商品数据采集工具，支持自动登录、多类目筛选、商品详情采集，并导出为 Excel 和 JSON 格式。

## 功能特性

- 自动登录京东万商平台，支持 Cookie 持久化（按账号独立保存）
- 自动处理风控验证（需手动完成验证）
- 自动筛选"自营"类型商品
- 支持多类目批量爬取，每个类目独立保存
- 自动滚动加载，确保获取完整商品列表
- 智能等待 API 响应，确保数据完整
- 采集商品详情页数据：
  - 商品名称、品牌、分类
  - 价格（京东价、建议零售价、主显示价）
  - 起购数量
  - 保质期、生产日期
  - 主图（多张）
  - 规格参数
  - 详情图（多张）
- 导出为 Excel (.xlsx) 和 JSON 格式

## 环境要求

- Python 3.8+
- 支持 Mac / Linux / Windows

## 快速开始

### 1. 安装依赖

**Mac / Linux:**
```bash
./install.sh
```

**Windows:**
```batch
install.bat
```

### 2. 配置账号

复制配置文件并填写账号信息：

```bash
cp .env.example .env
```

编辑 `.env` 文件：

```ini
# 京东万商账号
JD_USERNAME=你的用户名
JD_PASSWORD=你的密码

# 爬取配置
# 支持多个类目，用逗号分隔
CATEGORY_NAMES=薯片薯条,坚果,糕点/派
START_PAGE=1
END_PAGE=3
```

**可用类目示例：** 坚果、薯片薯条、其它膨化食品、糕点/派、夹心饼干、薯片虾条、坚果蜜饯礼盒 等

### 3. 运行爬虫

**Mac / Linux:**
```bash
./run.sh
```

**Windows:**
```batch
run.bat
```

## 输出文件

采集结果保存在 `output/` 目录，每个类目独立保存：

```
output/
├── products_薯片薯条_20260204_120000.xlsx
├── products_薯片薯条_20260204_120000.json
├── products_坚果_20260204_121500.xlsx
├── products_坚果_20260204_121500.json
├── products_糕点_派_20260204_123000.xlsx
└── products_糕点_派_20260204_123000.json
```

### Excel 字段说明

| 字段 | 说明 |
|------|------|
| SKU ID | 商品唯一标识 |
| 商品名称 | 商品标题 |
| 品牌 | 品牌名称 |
| 分类 | 商品分类 |
| 京东价 | B2B 采购价 |
| 建议零售价 | 建议零售价格 |
| 主显示价 | 页面主显示价格 |
| 起购数量 | 最低起购数量（无则默认9999） |
| 保质期 | 商品保质期 |
| 生产日期 | 商品生产日期 |
| 主图1-5 | 商品主图URL |
| 参数JSON | 规格参数（JSON格式） |
| 详情图数量 | 详情图张数 |
| 详情图列表 | 详情图URL列表 |

## 多账号支持

每个账号的登录凭证独立保存在 `cookies/` 目录：

```
cookies/
├── cookies_user1.json
├── cookies_user2.json
└── cookies_user3.json
```

切换账号只需修改 `.env` 中的 `JD_USERNAME` 和 `JD_PASSWORD`，会自动加载对应账号的 cookies。

## 注意事项

1. **首次登录**：首次运行会打开浏览器进行登录，如遇验证码需手动完成
2. **Cookie 有效期**：登录成功后会保存 Cookie，下次运行可自动登录
3. **风控验证**：如遇到风控页面，请在浏览器中手动完成验证
4. **采集频率**：建议适当控制采集速度，避免触发风控
5. **类目名称**：如果类目名包含特殊字符（如 `/`），文件名中会替换为 `_`

## 项目结构

```
b2b-jd-crawl/
├── crawler_full.py      # 主爬虫脚本
├── requirements.txt     # Python 依赖
├── .env.example         # 配置文件模板
├── .env                 # 配置文件（需自行创建）
├── install.sh / .bat    # 安装脚本
├── run.sh / .bat        # 启动脚本
├── cookies/             # 登录凭证目录（按账号保存）
└── output/              # 输出目录
```

## 常见问题

**Q: 提示"未找到类目"怎么办？**

A: CATEGORY_NAMES 必须是页面筛选区"类目"行中的选项。运行时如果找不到会列出可用类目。

**Q: 登录超时怎么办？**

A: 如果自动登录超时，会提示手动登录。在浏览器中完成登录后按 Enter 继续。

**Q: 采集数据不完整？**

A: 检查网络连接，确保页面完全加载。可以尝试增加等待时间或减少采集页数。

**Q: 如何切换账号？**

A: 修改 `.env` 中的 `JD_USERNAME` 和 `JD_PASSWORD`，程序会自动加载对应账号的 cookies。

**Q: 中断后数据会丢失吗？**

A: 不会。每个类目完成后会立即保存，中断时也会保存当前类目已采集的数据。

## License

MIT
